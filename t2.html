<html>

<head language="en">
    <meta charset="utf-8">
    <script>
        // TwitchTV blog https://blog.twitch.tv/client-id-required-for-kraken-api-calls-afbb8e95f843
        // call the Twitch API for a channel 
        var twitchTVurl = "https://www.twitch.tv/"
        var oldTwitchTVAPI = "https://api.twitch.tv/kraken/channels/";
        var newTwitchTVAPI = "https://api.twitch.tv/kraken/streams/";
        var clientID = "f55ioj18oatngrd7rqz31sg5lqjxfd";

        var channelArr = [
            "freecodecamp",
            "ESL_SC2",
            "noobs2ninjas",
            "OgamingSC2",
            "cretetion",
            "RobotCaleb",
            "habathcx",
            "storbeck",
            "clashroyale",
            "dreamhackpubg",
            "quakechampions",
            "magic",
            "dreamhackhs",
            "dreamleague",
            "vaporadark",
            "4wardprogressmadden",
            "joltzie",
            "fauxre",
            "dreamhackcsgo_ru",
            "Yogscast",
            "imaqtpie",
            "AdmiralBulldog",
            "A1taOda",
            "Sacriel"
        ];

        var channelObjArr = [];
        var newTwitchTVAPIArr = [];
        var twitchAPIv5Arr = [];

        document.onreadystatechange = function () {
            if (document.readyState === "interactive") {
                for (i = 0; i < channelArr.length; i++) {
                    // DOM elements creation 
                    var wrapperBox = document.createElement("a");
                    wrapperBox.id = "wrapper" + i;
                    wrapperBox.className = "wrapper";
                    document.getElementById("total-wrapper").appendChild(wrapperBox);

                    var logoBox = document.createElement("img");
                    logoBox.className = "logo";
                    logoBox.id = "logo" + i;
                    logoBox.src = "#";
                    logoBox.alt = "channel logo";
                    document.getElementById("wrapper" + i).appendChild(logoBox);

                    var statusBox = document.createElement("div");
                    statusBox.className = "status";
                    statusBox.id = "status" + i;
                    statusBox.innerHTML = "loading..."
                    document.getElementById("wrapper" + i).appendChild(statusBox);

                    var nameBox = document.createElement("div");
                    nameBox.id = "name" + i;
                    nameBox.className = "name";
                    nameBox.innerHTML = "loading...";
                    document.getElementById("wrapper" + i).appendChild(nameBox);

                    var descriptionBox = document.createElement("div");
                    descriptionBox.id = "description" + i;
                    descriptionBox.className = "description";
                    descriptionBox.innerHTML = "loading...";
                    document.getElementById("wrapper" + i).appendChild(descriptionBox);
                    // LET'S FILL THESE DOM ELEMENTS WITH DATA
                    (function (i) {
                        // data I can already push to the page, prior to API calls
                        channelObjArr.push(new Object());
                        channelObjArr[i].display_name = channelArr[i];
                        nameBox.innerHTML = channelObjArr[i].display_name;

                        channelObjArr[i].url = twitchTVurl + channelArr[i];
                        wrapperBox.href = channelObjArr[i].url;

                        // API CALLS TIME! 
                        twitchAPIv5Arr.push(new XMLHttpRequest());
                        twitchAPIv5Arr[i].open("GET", oldTwitchTVAPI + channelArr[i]);
                        twitchAPIv5Arr[i].setRequestHeader("Client-ID", clientID);
                        twitchAPIv5Arr[i].send();

                        twitchAPIv5Arr[i].onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                var result = JSON.parse(this.response);
                                channelObjArr[i].id = result._id;
                                channelObjArr[i].description = result.status;
                                channelObjArr[i].updated_at = result.updated_at;
                                channelObjArr[i].video_banner = result.video_banner;

                                channelObjArr[i].url = result.url;
                                channelObjArr[i].logo = result.logo;
                                if (false) {
                                    channelObjArr[i].status = "offline";
                                }

                                document.getElementById("logo" + i).src = channelObjArr[i].logo;
                                document.getElementById("status" + i).innerHTML = channelObjArr[i].status; // offline/online
                                document.getElementById("description" + i).innerHTML = channelObjArr[i].description;
                            }
                        }
                    })(i);

                    (function (i) {
                        // THIS API HAS DATA ONLY IF THE CHANNEL IS ONLINE / OFFLINE 
                        newTwitchTVAPIArr.push(new XMLHttpRequest());
                        newTwitchTVAPIArr[i].open("GET", newTwitchTVAPI + channelArr[i]);
                        newTwitchTVAPIArr[i].setRequestHeader("Client-ID", clientID);
                        newTwitchTVAPIArr[i].send();

                        newTwitchTVAPIArr[i].onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                var result2 = JSON.parse(this.response);
                                if (result2.stream == null) {
                                    channelObjArr[i].status = "offline";
                                }
                                else {
                                    channelObjArr[i].status = "online";
                                }
                                document.getElementById("status" + i).innerHTML = channelObjArr[i].status; // offline/online
                            }
                        }
                    })(i);
                };

            }
        }

    </script>
    <style>
        body {
            align-content: center;
            justify-content: center;
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
            background-color: rgb(75, 75, 75);
            color: white;
            word-wrap: break-word;
            word-break: break-all;
        }

        h1 {
            align-content: center;
        }

        a {
            color: black;
            text-decoration: none;

        }

        .logo {
            border-radius: 10px;
            border: solid;
            border-color: rgb(226, 224, 224);
            border-width: 1px;
        }

        footer {
            margin-top: 20px;
        }

        .total-wrapper {
            border-radius: 10px;
            text-align: left;
            font-size: small;
            margin: 10px;
            color: black;
            width: minmax(200px, 1fr);
        }

        .wrapper {
            background-color: rgb(226, 224, 224);
            display: grid;
            grid-template-columns: 50px 70px 1fr 3fr;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 0px;
            border-top-left-radius: 10px;
            align-items: center;

        }

        .wrapper:first-child {
            border-top-right-radius: 10px;
        }

        .wrapper:last-child {
            border-bottom-right-radius: 10px;
        }

        .wrapper:hover {
            background-color: rgb(168, 168, 168);
        }

        .logo {
            width: 50px;
            height: auto;
        }

        .status,
        .name,
        .description {
            padding-left: 10px;
        }
    </style>
</head>

<body>
    <h1>TwitchTV Feed 3</h1>
    <h2>a freecodecamp project</h2>
    <div class="total-wrapper" id="total-wrapper">
    </div>
</body>
<footer>Coded in vanilla JS.</footer>

</html>
